---
title: "Tornado Analysis"
author: "Owen Widdis"
date: "2025-12-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
library(quantmod)
library(scales)
options(scipen = 999)

```

```{r}
# Load CSV
tornado_df <- read_csv("C:/Users/walke/Documents/umich/courses/SI544/final_proj/tornado_analysis/csv_files/merged_files.csv")

# Convert numeric columns
numeric_cols <- c(
  "TOR_LENGTH", "TOR_WIDTH",
  "DEATHS_DIRECT", "INJURIES_DIRECT",
  "DAMAGE_PROPERTY_NUM", "DAMAGE_CROPS_NUM"
)

tornado_df <- tornado_df %>%
  mutate(across(all_of(numeric_cols), ~as.numeric(.)))

# Convert dates + create DATE column for joining
tornado_df <- tornado_df %>%
  mutate(
    BEGIN_DATE = mdy(BEGIN_DATE),
    END_DATE   = mdy(END_DATE),
    DATE       = as.Date(BEGIN_DATE),
    YEAR       = year(BEGIN_DATE)
  )

tornado_df <- tornado_df %>%
  select(
    -EVENT_ID,
    -CZ_NAME_STR,
    -EVENT_TYPE
  )

glimpse(tornado_df)
```


```{r}

# Download CPI from FRED (monthly)
getSymbols("CPIAUCSL", src = "FRED")

# Convert to tibble
cpi_df <- CPIAUCSL %>%
  data.frame(date = index(.)) %>%
  as_tibble() %>%
  rename(CPIAUCSL = CPIAUCSL)

# 2025 CPI target (your value)
target_cpi <- 324.368

# Inflation adjustment factor
cpi_df <- cpi_df %>%
  mutate(adj_factor = target_cpi / CPIAUCSL)

glimpse(cpi_df)

```

```{r}
tornado_df <- tornado_df %>%
  mutate(
    DATE = as.Date(BEGIN_DATE),
    DATE_MONTH = floor_date(DATE, unit = "month")
  )

# Left join by DATE (tornado) and date (CPI)
tornado_df <- tornado_df %>%
  left_join(cpi_df, by = c("DATE_MONTH" = "date"))

```

```{r}
tornado_df <- tornado_df %>%
  mutate(
    DAMAGE_PROPERTY_2025 = DAMAGE_PROPERTY_NUM * adj_factor,
    DAMAGE_CROPS_2025    = DAMAGE_CROPS_NUM * adj_factor,
    DAMAGE_PROPERTY_2025_DOL = dollar(DAMAGE_PROPERTY_2025),
    DAMAGE_CROPS_2025_DOL    = dollar(DAMAGE_CROPS_2025)
  )

glimpse(tornado_df)

```

```{r}
# Clean tornado dataset with uppercase column names
tornado_clean <- tornado_df %>%
  # Keep only relevant columns (uppercase)
  select(
    DATE, YEAR,
    BEGIN_DATE, END_DATE,
    BEGIN_LAT, BEGIN_LON,
    END_LAT, END_LON,
    TOR_LENGTH, TOR_WIDTH,
    DEATHS_DIRECT, INJURIES_DIRECT,
    DAMAGE_PROPERTY_NUM, DAMAGE_CROPS_NUM,
    DAMAGE_PROPERTY_2025, DAMAGE_CROPS_2025
  ) %>%
  # Rename columns to uppercase + more readable
  rename(
    START_DATE = BEGIN_DATE,
    END_DATE   = END_DATE,
    START_LAT  = BEGIN_LAT,
    START_LON  = BEGIN_LON,
    END_LAT    = END_LAT,
    END_LON    = END_LON,
    TORNADO_LENGTH = TOR_LENGTH,
    TORNADO_WIDTH  = TOR_WIDTH,
    DEATHS  = DEATHS_DIRECT,
    INJURIES = INJURIES_DIRECT,
    DAMAGE_PROPERTY = DAMAGE_PROPERTY_NUM,
    DAMAGE_CROPS    = DAMAGE_CROPS_NUM,
    DAMAGE_PROPERTY_2025_USD = DAMAGE_PROPERTY_2025,
    DAMAGE_CROPS_2025_USD    = DAMAGE_CROPS_2025
  ) %>%
  # Add formatted dollar versions for display
  mutate(
    DAMAGE_PROPERTY_2025_DOL = dollar(DAMAGE_PROPERTY_2025_USD),
    DAMAGE_CROPS_2025_DOL    = dollar(DAMAGE_CROPS_2025_USD)
  ) %>%
  # Sort by DATE ascending
  arrange(DATE)

# Preview
glimpse(tornado_clean)

```
